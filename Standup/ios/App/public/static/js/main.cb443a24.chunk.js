(this.webpackJsonpStandup=this.webpackJsonpStandup||[]).push([[1],{250:function(n){n.exports=JSON.parse('{"apiKey":"AIzaSyCPDJA--fR3525vZXh_bkF-Piplurm5IJQ","authDomain":"standuptest-8d545.firebaseapp.com","databaseURL":"https://standuptest-8d545.firebaseio.com","projectId":"standuptest-8d545","storageBucket":"standuptest-8d545.appspot.com","messagingSenderId":"58134839933","appId":"1:58134839933:web:630bb5ef233e9a84cee714","measurementId":"G-85RB1CTVEG"}')},255:function(n,e,o){n.exports=o(546)},261:function(n,e,o){var t={"./ion-action-sheet.entry.js":[548,5],"./ion-alert.entry.js":[549,6],"./ion-app_8.entry.js":[550,7],"./ion-avatar_3.entry.js":[551,18],"./ion-back-button.entry.js":[552,19],"./ion-backdrop.entry.js":[553,43],"./ion-button_2.entry.js":[554,20],"./ion-card_5.entry.js":[555,21],"./ion-checkbox.entry.js":[556,22],"./ion-chip.entry.js":[557,23],"./ion-col_3.entry.js":[558,44],"./ion-datetime_3.entry.js":[559,10],"./ion-fab_3.entry.js":[560,24],"./ion-img.entry.js":[561,45],"./ion-infinite-scroll_2.entry.js":[562,46],"./ion-input.entry.js":[563,25],"./ion-item-option_3.entry.js":[564,26],"./ion-item_8.entry.js":[565,27],"./ion-loading.entry.js":[566,28],"./ion-menu_3.entry.js":[567,29],"./ion-modal.entry.js":[568,8],"./ion-nav_2.entry.js":[569,15],"./ion-popover.entry.js":[570,9],"./ion-progress-bar.entry.js":[571,30],"./ion-radio_2.entry.js":[572,31],"./ion-range.entry.js":[573,32],"./ion-refresher_2.entry.js":[574,11],"./ion-reorder_2.entry.js":[575,17],"./ion-ripple-effect.entry.js":[576,47],"./ion-route_4.entry.js":[577,33],"./ion-searchbar.entry.js":[578,34],"./ion-segment_2.entry.js":[579,35],"./ion-select_3.entry.js":[580,36],"./ion-slide_2.entry.js":[581,48],"./ion-spinner.entry.js":[582,13],"./ion-split-pane.entry.js":[583,49],"./ion-tab-bar_2.entry.js":[584,37],"./ion-tab_2.entry.js":[585,16],"./ion-text.entry.js":[586,38],"./ion-textarea.entry.js":[587,39],"./ion-toast.entry.js":[588,40],"./ion-toggle.entry.js":[589,12],"./ion-virtual-scroll.entry.js":[590,50]};function i(n){if(!o.o(t,n))return Promise.resolve().then((function(){var e=new Error("Cannot find module '"+n+"'");throw e.code="MODULE_NOT_FOUND",e}));var e=t[n],i=e[0];return o.e(e[1]).then((function(){return o(i)}))}i.keys=function(){return Object.keys(t)},i.id=261,n.exports=i},263:function(n,e,o){var t={"./ion-icon.entry.js":[594,57]};function i(n){if(!o.o(t,n))return Promise.resolve().then((function(){var e=new Error("Cannot find module '"+n+"'");throw e.code="MODULE_NOT_FOUND",e}));var e=t[n],i=e[0];return o.e(e[1]).then((function(){return o(i)}))}i.keys=function(){return Object.keys(t)},i.id=263,n.exports=i},279:function(n,e){},281:function(n,e){},292:function(n,e){},294:function(n,e){},320:function(n,e){},322:function(n,e){},323:function(n,e){},329:function(n,e){},331:function(n,e){},349:function(n,e){},351:function(n,e){},363:function(n,e){},366:function(n,e){},386:function(n,e){},388:function(n,e){},411:function(n,e){},545:function(n,e,o){},546:function(n,e,o){"use strict";o.r(e);var t,i=o(0),s=o.n(i),c=o(86),l=o.n(c),r=o(36),u=o(9),a=o(248),d=o(58),f=o(59),b=(o(268),o(270),o(250)),p=new f.auth.GoogleAuthProvider;f.initializeApp(b);var v=f.firestore();function g(){f.auth().signInWithRedirect(p)}function h(){var n;v.collection("users").doc(null===(n=t)||void 0===n?void 0:n.uid).update({OTToken:"null",currentSessionID:"null",isPublisher:!1,connectionID:"null"}),f.auth().signOut()}function m(){var n=Object(i.useState)(null),e=Object(d.a)(n,2),o=e[0],s=e[1];return Object(i.useEffect)((function(){f.auth().onAuthStateChanged((function(n){s(n||null),function(n){n&&v.collection("users").doc(null===n||void 0===n?void 0:n.uid).get().then((function(e){e.exists?v.collection("users").doc(null===n||void 0===n?void 0:n.uid).update({displayName:null===n||void 0===n?void 0:n.displayName}):v.collection("users").doc(null===n||void 0===n?void 0:n.uid).set({displayName:null===n||void 0===n?void 0:n.uid,OTToken:"null",currentSessionID:"null",isPublisher:!1,connectionID:"null"})}))}(n)}))}),[]),t=o,o}function E(n,e,o){var t=Object(i.useState)("null"),s=Object(d.a)(t,2),c=s[0],l=s[1];return Object(i.useEffect)((function(){v.collection(n).doc(e).onSnapshot((function(n){var e=n.data();void 0!=e&&l(e[o])}))}),[n,e,o]),c}var y=o(273),j=o(525),S=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).REACT_APP_OPENTOK_API_KEY,D=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).REACT_APP_OPENTOK_API_SECRET,I=new y(S,D),_=new Map;function O(n){I.createSession({mediaMode:"routed"},(function(e,o){if(e)return console.log(e);var t=o.sessionId;console.log("sessionID: "+t);var i=new Map;i.set("",void 0);var s={clientSessions:i,publisher:void 0,subscriber:void 0,publisherConnectionID:"null"};_.set(t,s),function(n){"null"!=n&&(v.collection("sessions").doc(n).set({sessionID:n,upvotes:0,downvotes:0,publisherConnectionID:"null"}),console.log("added session to database"))}(t),console.log("Map size:"+_.size),C(n,t,!0),v.collection("users").doc(n).update({isPublisher:!0})}))}function C(n,e,o){if("null"==e)return console.log("Unable to connect to session: "+e);if(void 0!=_.get(e)&&void 0!=_.get(e).clientSessions&&void 0!=k(n,e))return console.log("Already connected to this session!!!");if(void 0==_.get(e))P(n,e),console.log("inside if");else if(void 0==_.get(e).clientSessions){var t=new Map;t.set(n,j.initSession(S,e)),_.get(e).clientSessions=t,console.log("inside else if")}else _.get(e).clientSessions.set(n,j.initSession(S,e));var i=k(n,e),s=I.generateToken(e);i.on({connectionCreated:function(n){console.log("ConnectionCreatedEvent: ConnectionID:"+n.connection.connectionId)},connectionDestroyed:function(o){var t=_.get(e).publisherConnectionID;console.log(o.connection.connectionId+" | "+t),o.connection.connectionId===t&&(v.collection("users").doc(n).update({OTToken:"null",currentSessionID:"null",isPublisher:!1,connectionID:"null"}),i.disconnect(),console.log("Updated All Users")),console.log("ConnectionDestroyedEvent: "+o.connection.connectionId)},sessionDisconnected:function(e){console.log("Disconnected from the session."),"networkDisconnected"==e.reason&&alert("Your network connection terminated."),v.collection("users").doc(n).update({OTToken:"null",currentSessionID:"null",isPublisher:!1,connectionID:"null"})},streamCreated:function(n){void 0==_.get(e).subscriber&&(_.get(e).subscriber=i.subscribe(n.stream),console.log("subscribed to stream"))},streamDestroyed:function(n){v.collection("sessions").doc(e).delete(),console.log("StreamDestroyedEvent")}});var c="null";return i.connect(s,(function(t){t?console.log("Unable to connect: ",t.message):(console.log("Connected to the session."),v.collection("users").doc(n).update({OTToken:s,currentSessionID:e,connectionID:i.connection.connectionId}),1==o&&(v.collection("sessions").doc(e).update({publisherConnectionID:i.connection.connectionId}),c=i.connection.connectionId))})),c}function T(n,e,o,t){if("null"==e)return console.log("Unable to connect to session: "+e);var i=k(n,e);void 0!=i?(void 0!=_.get(e).subscriber&&(i.unsubscribe(_.get(e).subscriber),console.log("unsubscribed to stream")),i.disconnect(),v.collection("users").doc(n).update({OTToken:"null",currentSessionID:"null",isPublisher:!1,connectionID:"null"}),o&&(void 0!=_.get(e).publisher&&(i.unpublish(function(n){if(void 0!=_.get(n))return _.get(n).publisher;return}(e)),console.log("Session unpublished!")),v.collection("sessions").doc(e).delete()),_.delete(e)):console.log("This session is not defined, cannot disconnect!")}function P(n,e){var o=new Map,t=j.initSession(S,e);o.set(n,t);var i={clientSessions:o,publisher:void 0,subscriber:void 0,publisherConnectionID:"null"};_.set(e,i)}function k(n,e){if(void 0!=_.get(e)&&void 0!=_.get(e).clientSessions.get(n))return _.get(e).clientSessions.get(n)}var w=function(){var n=m(),e=n?n.uid:"null",o=E("users",e,"OTToken"),t=E("users",e,"currentSessionID"),c=function(n){var e=Object(i.useState)([]),o=Object(d.a)(e,2),t=o[0],s=o[1];return Object(i.useEffect)((function(){v.collection("users").where("currentSessionID","==",n).onSnapshot((function(e){var o=e.docs,t=new Set;o.forEach((function(n){var e=n.data();void 0!=e&&t.add(e.connectionID)}));var i=Array.from(t);console.log("SessionID: "+n+" | ["+i.toString()+"]"),s(i)}))}),[n]),t}(t),l=E("users",e,"isPublisher"),r=function(n){var e=Object(i.useState)(void 0),o=Object(d.a)(e,2),t=o[0],s=o[1];return Object(i.useEffect)((function(){v.collection(n).onSnapshot((function(n){var e=n.docs;s(e)}))}),[n]),t}("sessions"),a=E("users",e,"connectionID"),f=(E("sessions",t,"upvotes"),E("sessions",t,"downvotes"),E("sessions",t,"publisherConnectionID"));return"null"!=f&&"null"!=t?function(n,e){void 0!=_.get(n)&&(_.get(n).publisherConnectionID=e,console.log("Set publisher connection id: "+e))}(t,f):f="null",s.a.createElement(u.d,null,s.a.createElement(u.c,null,s.a.createElement("h1",null,"Home"),s.a.createElement("p",null,"UID: ",e),s.a.createElement("p",null,"Token: ",o),s.a.createElement("p",null,"SessionID: ",t),s.a.createElement("p",null,"Email: ",null===n||void 0===n?void 0:n.email),s.a.createElement("p",null,"Is connected? ","null"==t?"False":"True"),s.a.createElement("p",null,"Is publisher? ",l?"True":"False"),s.a.createElement("p",null,"ConnectionID: ",a),s.a.createElement("p",null,"Publisher ConnnectionID: ",f," "),s.a.createElement(u.b,{onClick:h},"Logout"),"null"==t?s.a.createElement(u.b,{onClick:function(){O(e)}},"Create a Session"):console.log(),"null"!=t?s.a.createElement(u.b,{onClick:function(){T(e,t,l)}},"Disconnect"):console.log(),"null"!=t&&l?s.a.createElement(u.b,{onClick:function(){!function(n,e){if("null"==e)return console.log("Cannot publish session: "+e);if(_.get(e).publisher)return console.log("Cannot publish more than once!");P(n,e);var o=k(n,e),t=j.initPublisher({insertMode:"after"},{resolution:"1280x720",frameRate:30});_.get(e).publisher=t;try{void 0!=o?(o.publish(t,(function(n){n?console.log(n):console.log("Publishing Session")})),t.on("streamCreated",(function(n){console.log("The publisher started streaming.")}))):console.log("Unable to Publish!")}catch(i){console.log("Unable to Publish due to error!")}}(e,t)}},"Publish Session"):console.log(),s.a.createElement("div",null,s.a.createElement("h2",null,"All Available Sessions"),null===r||void 0===r?void 0:r.map((function(n){if("default"!=n.id)return s.a.createElement("li",{key:n.id},"default"==n.id?console.log():n.id,"null"==t?s.a.createElement(u.b,{onClick:function(){return C(e,n.id,l)}},"Join"):console.log())}))),s.a.createElement("div",null,s.a.createElement("h2",null,"All Users in Session: ",t),c.toString())))},A=function(){return s.a.createElement(u.d,null,s.a.createElement(u.c,null,s.a.createElement("h1",null,"Login"),s.a.createElement(u.b,{onClick:g},"Login with Google")))},U=(o(535),o(536),o(537),o(538),o(539),o(540),o(541),o(542),o(543),o(544),o(545),function(){return s.a.createElement(u.a,null,s.a.createElement(a.a,null,s.a.createElement(u.f,null,s.a.createElement(r.b,{path:"/home",component:m()?w:A,exact:!0}),s.a.createElement(r.b,{exact:!0,path:"/",render:function(){return s.a.createElement(r.a,{to:"/home"})}}))))});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(s.a.createElement(U,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(n){n.unregister()}))}},[[255,3,4]]]);
//# sourceMappingURL=main.cb443a24.chunk.js.map